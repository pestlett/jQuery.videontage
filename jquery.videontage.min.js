/*
 * jQuery videontage 1.0
 *
 *             DO WHAT THE FUCK YOU WANT TO PUBLIC LICENSE
 *                   Version 2, December 2004
 *
 * Copyright (C) 2004 Sam Hocevar <sam@hocevar.net>
 *
 * Everyone is permitted to copy and distribute verbatim or modified
 * copies of this license document, and changing it is allowed as long
 * as the name is changed.
 *
 *          DO WHAT THE FUCK YOU WANT TO PUBLIC LICENSE
 * TERMS AND CONDITIONS FOR COPYING, DISTRIBUTION AND MODIFICATION
 *
 * 0. You just DO WHAT THE FUCK YOU WANT TO.
 *
 * Author: Martin Jewell
 * Date: 20130311
 */
(function(a,h){var v,k,j,r,w,x;j={};k=1;v={width:640,height:320,fps:25,cols:32,rows:32,distance:"euclidean",afterPreload:null,duringPreload:null,imageMap:null,imagePath:""};a.distance={euclidean:function(c,b){var g=Math.pow(Math.abs(c.r-b.r),2)+Math.pow(Math.abs(c.g-b.g),2)+Math.pow(Math.abs(c.b-b.b),2);return Math.sqrt(g)}};x=function(c,b,g,e){var d=j[c];null===d.imageMap&&a.error("You must have an image map, please see documentation for more details");var f,m;f=a.map(d.imageMap,function(c,b){return b}).length;
m=0;a.each(d.imageMap,function(h,j){var l=new Image;a(l).bind("load",function(){m++;b[h]=l;if(m>=f){var j=d.afterPreload||function(){console.log("Resources Loaded")};(function(){j.call(this,d);a(g).bind("play",{uuid:c,images:b,video:g,ctx:e},r)})()}null!==d.duringPreload&&d.duringPreload.call(this,{count:m,total:f,currentImage:l})});l.src=d.imagePath+j.filename})};w=function(c,b){var g,e,d,f;g=e=null;d=b.imageMap;f=a.distance[b.distance]||a.distance.euclidean;a.each(d,function(b,a){if(null===g||f.call(this,
c,a.dominantColor)<f.call(this,c,e))g=b,e=a.dominantColor});return g};r=function(c){var b,a,e,d;if(c===h)return!1;b=j[c.data.uuid];a=c.data.video;e=c.data.ctx;d=c.data.images;if(null===a||null===e||a.get(0).paused||a[0].ended)return!1;e.drawImage(a[0],0,0,b.width,b.height);var f,m,k,q,l;a=e.getImageData(0,0,b.width,b.height);f=a.data;e.clearRect(0,0,b.width,b.height);k=b.cols;m=b.rows;l=a.width/k;q=a.height/m;for(var n=0;n<m;n++)for(var s=0;s<k;s++){var t,u,p;t=s*l;u=n*q;p=(u+(q>>1)<<0)*(a.width<<
2)+(t+(l>>1)<<0<<2);p=w({r:f[p],b:f[p+2],g:f[p+1]},b);e.drawImage(d[p],t,u,l,q)}setTimeout(function(){r.call(this,c)},b.fps)};var n={init:function(c){var b,g,e,d;b=e=g=null;d={};c.width===h&&(this.prop("width")!==h?c.width=this.prop("width"):a(this).width()!==h&&(c.width=a(this).width()));c.height===h&&(this.prop("height")!==h?c.height=this.prop("height"):a(this).height()!==h&&(c.height=a(this).height()));return this.each(function(){var f;f=a(this);j[k]===h&&(j[k]=a.extend({},v,c));a.data(this,"uuid",
k);g=f[0];e=g.getContext("2d");b=a(g).find("video");(null===b||b[0]===h)&&a.error("You must have a video element inside the canvas element");x(k,d,b,e);k++})},update:function(c){this.each(function(){var b=a.data(this,"uuid");j[b]=a.extend({},j[b],c)})}};a.fn.videontage=function(c){if(n[c])return n[c].apply(this,Array.prototype.slice.call(arguments,1));if("object"===typeof c||!c)return n.init.apply(this,arguments);a.error("Method "+c+" does not exist on jQuery.videontage")}})(jQuery);