/*
 * jQuery videontage 1.0
 *
 *             DO WHAT THE FUCK YOU WANT TO PUBLIC LICENSE
 *                   Version 2, December 2004
 *
 * Copyright (C) 2004 Sam Hocevar <sam@hocevar.net>
 *
 * Everyone is permitted to copy and distribute verbatim or modified
 * copies of this license document, and changing it is allowed as long
 * as the name is changed.
 *
 *          DO WHAT THE FUCK YOU WANT TO PUBLIC LICENSE
 * TERMS AND CONDITIONS FOR COPYING, DISTRIBUTION AND MODIFICATION
 *
 * 0. You just DO WHAT THE FUCK YOU WANT TO.
 *
 * Author: Martin Jewell
 * Date: 20130311
 */
(function(b,f){var t,n,u,v,d,h,k,p,a;d=k=h=null;p={};t={width:640,height:320,fps:25,cols:32,rows:32,distance:"euclidean",afterPreload:null,duringPreload:null,imageMap:null,imagePath:""};b.distance={euclidean:function(c,a){var b=Math.pow(Math.abs(c.r-a.r),2)+Math.pow(Math.abs(c.g-a.g),2)+Math.pow(Math.abs(c.b-a.b),2);return Math.sqrt(b)}};v=function(){null===a.imageMap&&b.error("You must have an image map, please see documentation for more details");var c,j;c=b.map(a.imageMap,function(c,a){return a}).length;
j=0;b.each(a.imageMap,function(w,g){var e=new Image;b(e).bind("load",function(){j++;p[w]=e;if(j>=c){var g=a.afterPreload||function(){console.log("Resources Loaded")};(function(){g.call(this,a);b(d).bind("play",n)})()}null!==a.duringPreload&&a.duringPreload.call(this,{count:j,total:c,currentImage:e})});e.src=a.imagePath+g.filename})};u=function(c){var j,d,g,e;j=d=null;g=a.imageMap;e=b.distance[a.distance]||b.distance.euclidean;b.each(g,function(a,b){if(null===j||e.call(this,c,b.dominantColor)<e.call(this,
c,d))j=a,d=b.dominantColor});return j};n=function(){if(null===d||null===k||d.get(0).paused||d[0].ended)return!1;k.drawImage(d[0],0,0,a.width,a.height);var c,b,f,g,e,h;c=k.getImageData(0,0,a.width,a.height);b=c.data;k.clearRect(0,0,a.width,a.height);g=a.cols;f=a.rows;h=c.width/g;e=c.height/f;for(var l=0;l<f;l++)for(var q=0;q<g;q++){var r,s,m;r=q*h;s=l*e;m=(s+(e>>1)<<0)*(c.width<<2)+(r+(h>>1)<<0<<2);m=u({r:b[m],b:b[m+2],g:b[m+1]});k.drawImage(p[m],r,s,h,e)}setTimeout(n,a.fps)};var l={init:function(c){c=
b.extend({},c);a=b.extend(t,c);c.width===f&&(this.prop("width")!==f?a.width=this.prop("width"):b(this).width()!==f&&(a.width=b(this).width()));c.height===f&&(this.prop("height")!==f?a.height=this.prop("height"):b(this).height()!==f&&(a.height=b(this).height()));return this.each(function(){h=b(this)[0];k=h.getContext("2d");d=b(h).find("video");(null===d||d[0]===f)&&b.error("You must have a video element inside the canvas element");v()})},update:function(c){c=b.extend({},c);a=b.extend(a,c)}};b.fn.videontage=
function(a){if(l[a])return l[a].apply(this,Array.prototype.slice.call(arguments,1));if("object"===typeof a||!a)return l.init.apply(this,arguments);b.error("Method "+a+" does not exist on jQuery.videontage")}})(jQuery);
